FROM lemonadehq/numpy_pandas:v3

RUN mkdir /app
WORKDIR /app

# Setup git
ARG GIT_SSH_KEY
RUN mkdir /root/.ssh/
RUN echo "${GIT_SSH_KEY}" > /root/.ssh/id_rsa
RUN chmod 0400 /root/.ssh/id_rsa

RUN touch /root/.ssh/known_hosts
RUN ssh-keyscan github.com >> /root/.ssh/known_hosts

COPY requirements.in /requirements.in
RUN pip install -r /requirements.in
RUN pip check

COPY . /app

RUN wget https://s3.amazonaws.com/rds-downloads/rds-combined-ca-bundle.pem

ENV GUNICORN_WORKERS 1

CMD ["make", "run-api"]
