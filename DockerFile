FROM ruby:2.6.2-slim

# https://github.com/debuerreotype/docker-debian-artifacts/issues/66#issuecomment-476616579
RUN sed -i '/jessie-updates/d' /etc/apt/sources.list  # Now archived

RUN apt-get update && apt-get install -y unixodbc-dev unixodbc default-libmysqlclient-dev build-essential libcurl4-openssl-dev git

RUN mkdir /build
WORKDIR /build

COPY snowflake-odbc-2.17.6.x86_64.deb ./
RUN dpkg -i snowflake-odbc-2.17.6.x86_64.deb

RUN sed -i 's/SF_ACCOUNT/tq01613.us-east-1/' /etc/odbc.ini

RUN mkdir /app
WORKDIR /app

COPY Gemfile Gemfile.lock ./
RUN gem install bundler:2.0.2; bundle install --without=development

COPY . /app

CMD ["bundle", "exec", "rackup", "--host", "0.0.0.0", "-p", "3000"]
