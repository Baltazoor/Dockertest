FROM rasa/rasa:1.2.7-full
#FROM python:3.7

EXPOSE 5005

# we cannot write to the exisiting /app dir (dvc commands fail silently), so we create myapp to run dvc in it

RUN mkdir /myapp
WORKDIR /myapp

COPY requirements.txt /requirements.txt
RUN pip install -r /requirements.txt

COPY models-assessment /myapp/models-assessment
COPY models-production /myapp/models-production
COPY .dvc /myapp/.dvc

RUN dvc config core.no_scm true

RUN dvc pull -r dvc-proxy models-assessment/*dvc
RUN dvc pull -r dvc-proxy models-production/*dvc

WORKDIR /app
COPY entrypoint.sh /app
COPY run_rasa.py /app

ENTRYPOINT ["./entrypoint.sh"]
