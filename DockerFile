FROM node:10.11-alpine AS build
RUN apk add git python make
RUN mkdir /app
WORKDIR /app

COPY package*.json .npmrc /app/

# Setup NPM
ARG GITHUB_NPM_TOKEN
RUN echo "//npm.pkg.github.com/:_authToken=${GITHUB_NPM_TOKEN}" >> .npmrc

RUN npm i

FROM node:14.16-alpine

COPY --from=build /app /app
COPY . /app/

WORKDIR /app

CMD ["npm", "run", "storybook", "--", "--ci"]
